<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üß† Synapse ‚Äì Learning Made Easy</title>

  <link href="https://fonts.cdnfonts.com/css/opendyslexic" rel="stylesheet">

  <style>
    body {
      font-family: 'OpenDyslexic', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      margin: 0;
      padding: 0;
    }

    .hero {
      text-align: center;
      padding: 25px;
      color: white;
      font-size: 2.5em;
      font-weight: bold;
    }

    .container {
      max-width: 1100px;
      margin: auto;
      padding: 20px;
    }

    textarea {
      width: 100%;
      min-height: 150px;
      font-size: 1.5em;
      padding: 20px;
      border-radius: 15px;
      border: 3px solid #ddd;
      line-height: 2;
    }

    .btn {
      padding: 15px 30px;
      font-size: 1.4em;
      border-radius: 40px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      margin: 10px;
    }

    .primary {
      background: #FFD700;
    }

    .secondary {
      background: #4CAF50;
      color: white;
    }

    .output {
      margin-top: 30px;
      display: none;
    }

    .box {
      background: white;
      padding: 30px;
      border-radius: 20px;
      margin-bottom: 20px;
    }

    .title {
      font-size: 2.2em;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .visual {
      background: #F0F4F8;
      padding: 25px;
      border-radius: 15px;
      font-size: 1.8em;
      text-align: center;
      white-space: pre-line;
      margin-bottom: 20px;
      border: 4px solid #667eea;
    }

    .point {
      font-size: 1.5em;
      margin-bottom: 15px;
      line-height: 2;
    }

    .audio {
      margin-top: 20px;
      text-align: center;
    }

    .math-step {
      background: #E8F5E9;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 15px;
      font-size: 1.5em;
    }

    .answer {
      background: #FFD700;
      padding: 25px;
      border-radius: 15px;
      text-align: center;
      font-size: 2.5em;
      font-weight: bold;
    }
  </style>
</head>

<body>

  <div class="hero">üß† Synapse ‚Äì Learning Made Easy</div>

  <div class="container">

    <textarea id="inputText"
      placeholder="Try: photosynthesis, gravity, evaporation OR 5+3, 4*3"></textarea>

    <div style="text-align:center">
      <button class="btn primary" onclick="process('text')">üìö Simplify Text</button>
      <button class="btn secondary" onclick="process('math')">üî¢ Solve Math</button>
    </div>

    <div id="output" class="output"></div>

  </div>

<script>
let currentReadText = "";

async function process(mode) {
  const text = document.getElementById("inputText").value.trim();
  if (!text) {
    alert("Please type something üòä");
    return;
  }

  const output = document.getElementById("output");
  output.style.display = "none";

  try {
    const res = await fetch("https://easylearn-backend-le7k.onrender.com/process", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ text, mode })
    });

    const result = await res.json();
    if (!result.success) {
      alert(result.error);
      return;
    }

    mode === "text"
      ? showText(result.data)
      : showMath(result.data);

    output.style.display = "block";

  } catch {
    alert("Backend not running üò¢\nRun: python -m uvicorn main:app --reload");
  }
}

function showText(data) {
  currentReadText = data.read_aloud || data.title;

  document.getElementById("output").innerHTML = `
    <div class="box">
      <div class="title">${data.title}</div>

      <div class="visual">
        ${data.visual ? data.visual.join("<br>") : "No visual available"}
      </div>

      ${data.points.map(p => `<div class="point">üëâ ${p}</div>`).join("")}

      <div class="audio">
        <button class="btn secondary" onclick="readAloud()">üîä Read Aloud</button>
        <button class="btn" onclick="stopAudio()">‚èπ Stop</button>
      </div>
    </div>
  `;
}

function showMath(data) {
  currentReadText = data.read_aloud || "";

  document.getElementById("output").innerHTML = `
    <div class="box">
      <div class="title">${data.operation}</div>

      ${data.visual_steps.map(s => `
        <div class="math-step">
          <strong>${s.text}</strong><br>
          ${s.visual}<br>
          <em>${s.explanation}</em>
        </div>
      `).join("")}

      <div class="answer">Answer: ${data.answer}</div>

      <div class="audio">
        <button class="btn secondary" onclick="readAloud()">üîä Read Solution</button>
        <button class="btn" onclick="stopAudio()">‚èπ Stop</button>
      </div>
    </div>
  `;
}

function readAloud() {
  stopAudio();
  if (!currentReadText) return;
  const u = new SpeechSynthesisUtterance(currentReadText);
  u.rate = 0.9;
  u.lang = "en-US";
  speechSynthesis.speak(u);
}

function stopAudio() {
  speechSynthesis.cancel();
}
</script>

</body>
</html>